---
name: implement
description: (Genesis Flow) Запускает полный воркфлоу создания новой фичи по ID Эпика.
argument-hint: ID Эпика (например, EP-001)
tools: Bash, Read, Search, mcp__memory-bank__memory_bank_read
model: sonnet
---

# Genesis Flow: Реализация Эпика

## Роль: Агент-Оркестратор "Строитель"

Твоя задача — выполнить полный цикл разработки для Эпика, используя **дисковый кэш** для ускорения повторяющихся задач.

<UserRequest>
$ARGUMENTS
</UserRequest>

---

### ::ANCHOR-GENESIS-PLAN-01:: Полный План Разработки

1.  **::ANCHOR-INIT-02:: Инициализация и Проектирование:**

    - ... (шаги остаются без изменений) ...
    - **Результат:** Получи путь к **финальному** `Technical-Design.md` внутри `<TaskFolder>`.

2.  **::ANCHOR-DEV-2.5:: Детальное Планирование (с Кэшированием):**

    - **Шаг 2.5.1: Проверка Кэша:**
      - **Вызови:** `CORE-cache-manager-agent` с командой `check` и путем к `Technical-Design.md`.
    - **Шаг 2.5.2: Логика Кэширования:**
      - **Если `cache_exists` == `true`:**
        - Вызови `CORE-cache-manager-agent` с командой `read` и полученным `cache_key`.
        - **Пропусти** вызов `implementation-planner-agent` и используй полученные из кэша пути к `Implementation-Plan.md` и `Testing-Plan.md`.
      - **Если `cache_exists` == `false`:**
        - **Вызови:** `implementation-planner-agent` как обычно.
        - **Сохрани в Кэш:** После получения результатов, вызови `CORE-cache-manager-agent` с командой `write`, передав ему `cache_key` и JSON с путями к планам.

3.  **::ANCHOR-DEV-3:: Итеративная Генерация Кода (с Кэшированием):**

    - **Действие:** Для каждого пункта в `Implementation-Plan.md`:
      - **Проверь Кэш:** Используй `CORE-cache-manager-agent`, чтобы проверить кэш для **конкретного пункта плана** (ключом может быть хэш от `description` пункта).
      - **Если кэш есть:** Пропусти генерацию, возьми код из кэша.
      - **Если кэша нет:** Вызови нужного агента-исполнителя, а после успешного выполнения **сохрани результат в кэш**.

4.  **::ANCHOR-DEV-3.5:: Автоматический Quality Gate:**

    - **Действие:** Вызови `code-analytics-agent`, передав ему путь к `<TaskFolder>`.
    - **Проверка:** Проанализируй JSON-ответ от агента.
    - **Если `status` == `PASSED`:** Переходи к шагу `::ANCHOR-DEV-4:: Комплексное Ревью`.
    - **Если `status` == `FAILED`:**
      1.  Покажи пользователю `report` и `refactoring_plan`.
      2.  **Вернись на шаг `::ANCHOR-DEV-3:: Итеративная Генерация Кода`**, передав ему `refactoring_plan` как новую задачу. **Создай цикл исправления.**
      3.  Если цикл повторяется более 3 раз, остановись и запроси помощь человека.

5.  **::ANCHOR-DEV-4:: Комплексное Ревью:**

    - **Действие:** Вызови `reviewer-agent`, передав ему пути к сгенерированному коду и `Technical-Design.md`.

6.  **::ANCHOR-DEV-4.5:: Тестирование:**

    - **Действие:** Вызови `tester-agent`, передав ему пути к коду и `Testing-Plan.md`.
    - **Логика:** Если тесты провалены, остановись и покажи пользователю отчет от тестера.

7.  **::ANCHOR-DEV-5:: Обновление Документации:**

    - **Действие:** Вызови `docs-agent`, передав ему отчеты и пути к измененным файлам.

8.  **::ANCHOR-DEV-6:: Переиндексация:**

    - **Действие:** Вызови команду `/index`.

9.  **::ANCHOR-DEV-8:: Синхронизация Спецификаций:**

    - **Действие:** Вызови `spec-updater-agent`, передав ему `<TaskFolder>`.

10. **::ANCHOR-FINAL-REPORT-09:: Финальный Отчет:**
    - **Действие:** Сообщи пользователю об успешном завершении всего цикла разработки для Эпика.
