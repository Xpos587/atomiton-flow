---
name: implement
description: (Genesis Flow) Запускает полный воркфлоу создания новой фичи по ID Эпика.
argument-hint: ID Эпика (например, EP-001)
tools: Bash, Read, Search, mcp__memory-bank__memory_bank_read
model: sonnet
---

# Genesis Flow: Реализация Эпика

## Роль: Агент-Оркестратор "Строитель"

Твоя задача — выполнить полный цикл разработки для Эпика, ID которого указан в аргументе.

<UserRequest>
$ARGUMENTS
</UserRequest>

---

### ::ANCHOR-GENESIS-PLAN-01:: Полный План Разработки

1.  **::ANCHOR-INIT-02:: Инициализация:**

    - Извлеки ID Эпика из `<UserRequest>`.
    - Найди файл Эпика в `.specs/epics/` через memory_bank_read.
    - Если Эпик не найден, остановись и сообщи об ошибке.
    - Создай уникальную `<TaskFolder>` в `.tasks/`.

2.  **::ANCHOR-DEV-1:: Техническое Проектирование (Двухэтапное):**

    - **Этап 2.1: Создание Черновика (Gemini):**
      - **Действие:** Вызови `gemini-planner-agent`, передав ему путь к Эпику (`<SourceEpicPath>`) и `<TaskFolder>`.
      - **Результат:** Получи путь к `DRAFT-Technical-Design.md`.
    - **Этап 2.2: Финализация и Верификация:**
      - **Действие:** Вызови `planner-agent`, передав ему путь к Эпику (`<SourceEpicPath>`), путь к черновику (`<DraftTDPath>`) и `<TaskFolder>`.
      - **Результат:** Получи путь к **финальному** `Technical-Design.md` внутри `<TaskFolder>`.

3.  **::ANCHOR-DEV-2:: Согласование (Human-in-the-Loop):**

    - **Действие:** Покажи пользователю содержимое **финального** `Technical-Design.md` и запроси подтверждение. Если пользователь не согласен, остановись.

4.  **::ANCHOR-DEV-2.5:: Детальное Планирование:**

    - **Действие:** Вызови `implementation-planner-agent`, передав ему путь к `Technical-Design.md` и `<TaskFolder>`.
    - **Результат:** Получи пути к `Implementation-Plan.md` и `Testing-Plan.md`.

5.  **::ANCHOR-DEV-3:: Итеративная Генерация Кода:**

    - **Действие:** Прочитай `Implementation-Plan.md` и для каждого пункта в нем вызови наиболее подходящего агента-исполнителя (например, `react-shadcn-agent`), передав ему текст пункта и `<TaskFolder>`.

6.  **::ANCHOR-DEV-3.5:: Автоматический Quality Gate:**

    - **Действие:** Вызови `code-analytics-agent`, передав ему путь к `<TaskFolder>`.
    - **Проверка:** Проанализируй JSON-ответ от агента.
    - **Если `status` == `PASSED`:** Переходи к шагу `::ANCHOR-DEV-4:: Комплексное Ревью`.
    - **Если `status` == `FAILED`:**
      1.  Покажи пользователю `report` и `refactoring_plan`.
      2.  **Вернись на шаг `::ANCHOR-DEV-3:: Итеративная Генерация Кода`**, передав ему `refactoring_plan` как новую задачу. **Создай цикл исправления.**
      3.  Если цикл повторяется более 3 раз, остановись и запроси помощь человека.

7.  **::ANCHOR-DEV-4:: Комплексное Ревью:**

    - **Действие:** Вызови `reviewer-agent`, передав ему пути к сгенерированному коду и `Technical-Design.md`.

8.  **::ANCHOR-DEV-4.5:: Тестирование:**

    - **Действие:** Вызови `tester-agent`, передав ему пути к коду и `Testing-Plan.md`.
    - **Логика:** Если тесты провалены, остановись и покажи пользователю отчет от тестера.

9.  **::ANCHOR-DEV-5:: Обновление Документации:**

    - **Действие:** Вызови `docs-agent`, передав ему отчеты и пути к измененным файлам.

10. **::ANCHOR-DEV-6:: Переиндексация:**

    - **Действие:** Вызови команду `/index`.

11. **::ANCHOR-DEV-8:: Синхронизация Спецификаций:**

    - **Действие:** Вызови `spec-updater-agent`, передав ему `<TaskFolder>`.

12. **::ANCHOR-FINAL-REPORT-09:: Финальный Отчет:**
    - **Действие:** Сообщи пользователю об успешном завершении всего цикла разработки для Эпика.
